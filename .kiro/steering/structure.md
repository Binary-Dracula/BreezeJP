---
inclusion: always
---

# é¡¹ç›®æ¶æ„ä¸æ–‡ä»¶ç»„ç»‡

## æ¶æ„æ¨¡å¼ï¼šMVVM + Command/Query/Analytics/Repository + Riverpod

**æ•°æ®æµï¼š**

```
View â†’ Controller
           â”œâ”€â†’ Query (Read)
           â”œâ”€â†’ Analytics (Statistics)
           â””â”€â†’ Command (Behavior / Write)
                       â†“
                 Repository (Entity CRUD)
                       â†“
                    Database
```

**å„å±‚èŒè´£ï¼š**

| Layer          | èŒè´£                                                                               | ç¦æ­¢                                 |
| -------------- | ---------------------------------------------------------------------------------- | ------------------------------------ |
| **View**       | UI æ¸²æŸ“ã€ç”¨æˆ·äº¤äº’                                                                  | ç›´æ¥è®¿é—®æ•°æ®åº“ã€ä¸šåŠ¡é€»è¾‘ã€ä¿®æ”¹ state |
| **Controller** | ä¸šåŠ¡æµç¨‹ç¼–æ’ï¼ˆUse Case Orchestrationï¼‰ã€è°ƒç”¨ Command / Query / Analyticsã€çŠ¶æ€ç®¡ç† | æ ¸å¿ƒä¸šåŠ¡è§„åˆ™ã€ç›´æ¥ DB æŸ¥è¯¢           |
| **State**      | ä¸å¯å˜æ•°æ®å®¹å™¨                                                                     | å¯å˜å­—æ®µã€é€»è¾‘                       |
| **Repository** | Entity CRUDï¼ˆå•è¡¨æˆ–å¼ºä¸€è‡´å®ä½“ï¼‰                                                    | å¤æ‚æŸ¥è¯¢ã€ç»Ÿè®¡èšåˆã€ä¸šåŠ¡è¡Œä¸º         |
| **Model**      | æ•°æ®ç»“æ„ï¼Œå« `fromMap()`/`toMap()`                                                 | ä¸šåŠ¡é€»è¾‘                             |

**ç¡¬æ€§è§„åˆ™ï¼š**

- æ•°æ®è®¿é—®è·¯å¾„ï¼šRepository ä»…è¢« Command/Query/Analytics è°ƒç”¨ï¼ŒController ä»…è°ƒç”¨ Command/Query/Analytics
- Repository åªè¿”å›æ¨¡å‹å¯¹è±¡ï¼Œç»ä¸è¿”å› Map
- æ‰€æœ‰ State å¿…é¡»ä¸å¯å˜å¹¶æä¾› `copyWith()`
- æ‰€æœ‰ DB è®¿é—®å¿…é¡»ç”¨ `AppDatabase.instance` å•ä¾‹

## å®Œæ•´ç›®å½•ç»“æ„

```
lib/
â”œâ”€â”€ core/                    # å…±äº«åŸºç¡€èƒ½åŠ›å±‚
â”‚   â”œâ”€â”€ algorithm/           # SRS ç®—æ³•å®ç°
â”‚   â”‚   â”œâ”€â”€ algorithm_service.dart          # ç®—æ³•æœåŠ¡æŠ½è±¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ algorithm_service_provider.dart # ç®—æ³•æœåŠ¡ Riverpod Provider
â”‚   â”‚   â”œâ”€â”€ sm2_algorithm.dart              # SM-2 é—´éš”é‡å¤ç®—æ³•å®ç°
â”‚   â”‚   â”œâ”€â”€ fsrs_algorithm.dart             # FSRS è‡ªç”±é—´éš”é‡å¤ç®—æ³•å®ç°
â”‚   â”‚   â””â”€â”€ srs_types.dart                  # SRS ç®—æ³•é€šç”¨ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ constants/           # å…¨å±€å¸¸é‡å®šä¹‰
â”‚   â”‚   â””â”€â”€ app_constants.dart              # åº”ç”¨çº§å¸¸é‡ï¼ˆé»˜è®¤å€¼ã€é…ç½®ç­‰ï¼‰
â”‚   â”œâ”€â”€ network/             # ç½‘ç»œé€šä¿¡å±‚
â”‚   â”‚   â”œâ”€â”€ dio_client.dart                 # HTTP å®¢æˆ·ç«¯å°è£…ï¼ˆåŸºäº Dioï¼‰
â”‚   â”‚   â”œâ”€â”€ api_endpoints.dart              # API ç«¯ç‚¹ URL å®šä¹‰
â”‚   â”‚   â””â”€â”€ network_info.dart               # ç½‘ç»œè¿æ¥çŠ¶æ€æ£€æŸ¥å·¥å…·
â”‚   â”œâ”€â”€ utils/               # é€šç”¨å·¥å…·ç±»
â”‚   â”‚   â”œâ”€â”€ app_logger.dart                 # æ—¥å¿—ç³»ç»Ÿä¸»å…¥å£
â”‚   â”‚   â”œâ”€â”€ log_category.dart               # æ—¥å¿—åˆ†ç±»æšä¸¾å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ log_formatter.dart              # æ—¥å¿—æ ¼å¼åŒ–å™¨
â”‚   â”‚   â”œâ”€â”€ l10n_utils.dart                 # å›½é™…åŒ–è¾…åŠ©å·¥å…·
â”‚   â”‚   â”œâ”€â”€ LOGGER_QUICK_REF.md            # æ—¥å¿—ä½¿ç”¨å¿«é€Ÿå‚è€ƒæ–‡æ¡£
â”‚   â”‚   â””â”€â”€ README.md                       # å·¥å…·ç±»ä½¿ç”¨è¯´æ˜æ–‡æ¡£
â”‚   â””â”€â”€ widgets/             # è·¨åŠŸèƒ½å¤ç”¨ UI ç»„ä»¶
â”‚       â”œâ”€â”€ custom_ruby_text.dart          # è‡ªå®šä¹‰æ—¥æ–‡å‡åæ³¨éŸ³æ˜¾ç¤ºç»„ä»¶
â”‚       â””â”€â”€ stroke_order_animator.dart     # å‡åç¬”é¡ºåŠ¨ç”»æ’­æ”¾ç»„ä»¶
â”œâ”€â”€ data/                    # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ analytics/           # æ•°æ®åˆ†ææŸ¥è¯¢ï¼ˆç»Ÿè®¡èšåˆï¼‰
â”‚   â”‚   â”œâ”€â”€ study_word_analytics.dart       # å­¦ä¹ å•è¯æ•°æ®åˆ†æ
â”‚   â”‚   â””â”€â”€ word_analytics.dart             # å•è¯ç»Ÿè®¡åˆ†æ
â”‚   â”œâ”€â”€ commands/            # æ•°æ®æ“ä½œå‘½ä»¤ï¼ˆè¡Œä¸ºå†™å…¥ï¼‰
â”‚   â”‚   â””â”€â”€ study_word_command.dart         # å­¦ä¹ å•è¯æ“ä½œå‘½ä»¤
â”‚   â”œâ”€â”€ db/                  # æ•°æ®åº“ç®¡ç†
â”‚   â”‚   â””â”€â”€ app_database.dart               # SQLite æ•°æ®åº“å•ä¾‹ç®¡ç†å™¨
â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ read/            # åªè¯»æ•°æ®æ¨¡å‹ï¼ˆæŸ¥è¯¢ç»“æœï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ jlpt_level_count.dart       # JLPT ç­‰çº§ç»Ÿè®¡æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ user_word_statistics.dart   # ç”¨æˆ·å•è¯å­¦ä¹ ç»Ÿè®¡æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ word_list_item.dart         # å•è¯åˆ—è¡¨é¡¹æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ app_state.dart                  # åº”ç”¨å…¨å±€çŠ¶æ€æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ user.dart                       # ç”¨æˆ·ä¿¡æ¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ daily_stat.dart                 # æ¯æ—¥å­¦ä¹ ç»Ÿè®¡æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ word.dart                       # å•è¯åŸºç¡€ä¿¡æ¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ word_detail.dart                # å•è¯è¯¦ç»†ä¿¡æ¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ word_meaning.dart               # å•è¯é‡Šä¹‰æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ word_audio.dart                 # å•è¯éŸ³é¢‘æ–‡ä»¶æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ word_choice.dart                # å•è¯é€‰æ‹©é¢˜æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ word_with_relation.dart         # å¸¦å…³è”å…³ç³»çš„å•è¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ example_sentence.dart           # ä¾‹å¥æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ example_audio.dart              # ä¾‹å¥éŸ³é¢‘æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ study_word.dart                 # å•è¯å­¦ä¹ è¿›åº¦æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ study_log.dart                  # å­¦ä¹ è¡Œä¸ºæ—¥å¿—æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ kana_letter.dart                # å‡åå­—æ¯åŸºç¡€æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ kana_detail.dart                # å‡åè¯¦ç»†ä¿¡æ¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ kana_audio.dart                 # å‡åå‘éŸ³éŸ³é¢‘æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ kana_example.dart               # å‡åä½¿ç”¨ç¤ºä¾‹æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ kana_learning_state.dart        # å‡åå­¦ä¹ çŠ¶æ€æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ kana_log.dart                   # å‡åå­¦ä¹ æ—¥å¿—æ¨¡å‹
â”‚   â”‚   â””â”€â”€ kana_stroke_order.dart          # å‡åç¬”é¡ºæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ queries/             # åªè¯»æŸ¥è¯¢å°è£…
â”‚   â”‚   â”œâ”€â”€ study_word_query.dart           # å­¦ä¹ å•è¯æŸ¥è¯¢é€»è¾‘
â”‚   â”‚   â””â”€â”€ word_read_queries.dart          # å•è¯è¯»å–æŸ¥è¯¢é›†åˆ
â”‚   â””â”€â”€ repositories/        # æ•°æ®ä»“åº“å±‚ï¼ˆEntity CRUD + Providersï¼‰
â”‚       â”œâ”€â”€ active_user_provider.dart       # å½“å‰æ´»è·ƒç”¨æˆ· Provider
â”‚       â”œâ”€â”€ app_state_repository.dart       # åº”ç”¨çŠ¶æ€æ•°æ®ä»“åº“
â”‚       â”œâ”€â”€ app_state_repository_provider.dart
â”‚       â”œâ”€â”€ user_repository.dart            # ç”¨æˆ·æ•°æ®ä»“åº“
â”‚       â”œâ”€â”€ user_repository_provider.dart
â”‚       â”œâ”€â”€ daily_stat_repository.dart      # æ¯æ—¥ç»Ÿè®¡æ•°æ®ä»“åº“
â”‚       â”œâ”€â”€ daily_stat_repository_provider.dart
â”‚       â”œâ”€â”€ word_repository.dart            # å•è¯æ•°æ®ä»“åº“
â”‚       â”œâ”€â”€ word_repository_provider.dart
â”‚       â”œâ”€â”€ word_meaning_repository.dart    # å•è¯é‡Šä¹‰æ•°æ®ä»“åº“
â”‚       â”œâ”€â”€ word_meaning_repository_provider.dart
â”‚       â”œâ”€â”€ word_audio_repository.dart      # å•è¯éŸ³é¢‘æ•°æ®ä»“åº“
â”‚       â”œâ”€â”€ word_audio_repository_provider.dart
â”‚       â”œâ”€â”€ example_repository.dart         # ä¾‹å¥æ•°æ®ä»“åº“
â”‚       â”œâ”€â”€ example_repository_provider.dart
â”‚       â”œâ”€â”€ example_audio_repository.dart   # ä¾‹å¥éŸ³é¢‘æ•°æ®ä»“åº“
â”‚       â”œâ”€â”€ example_audio_repository_provider.dart
â”‚       â”œâ”€â”€ study_word_repository.dart      # å­¦ä¹ è¿›åº¦æ•°æ®ä»“åº“
â”‚       â”œâ”€â”€ study_word_repository_provider.dart
â”‚       â”œâ”€â”€ study_log_repository.dart       # å­¦ä¹ æ—¥å¿—æ•°æ®ä»“åº“
â”‚       â”œâ”€â”€ study_log_repository_provider.dart
â”‚       â”œâ”€â”€ kana_repository.dart            # å‡åæ•°æ®ä»“åº“
â”‚       â”œâ”€â”€ kana_repository_provider.dart
â”‚       â””â”€â”€ example_api_repository.dart     # å¤–éƒ¨ä¾‹å¥ API ä»“åº“
â”œâ”€â”€ debug/                   # å¼€å‘è°ƒè¯•å·¥å…·ï¼ˆä»… Debug æ¨¡å¼ï¼‰
â”‚   â”œâ”€â”€ controller/          # è°ƒè¯•åŠŸèƒ½æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ debug_controller.dart           # è°ƒè¯•é¢æ¿æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ pages/               # è°ƒè¯•é¡µé¢
â”‚   â”‚   â”œâ”€â”€ debug_page.dart                 # è°ƒè¯•ä¸»é¢æ¿é¡µé¢
â”‚   â”‚   â””â”€â”€ tests/           # è°ƒè¯•æµ‹è¯•é¡µé¢
â”‚   â”‚       â”œâ”€â”€ debug_kana_review_data_generator_page.dart  # å‡åå¤ä¹ æ•°æ®ç”Ÿæˆå™¨é¡µé¢
â”‚   â”‚       â””â”€â”€ debug_srs_test_page.dart    # SRS ç®—æ³•æµ‹è¯•é¡µé¢
â”‚   â”œâ”€â”€ state/               # è°ƒè¯•çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ debug_state.dart                # è°ƒè¯•é¢æ¿çŠ¶æ€
â”‚   â”œâ”€â”€ tmp/                 # ä¸´æ—¶è°ƒè¯•æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ debug_kana_review_tmp.dart      # å‡åå¤ä¹ ä¸´æ—¶è°ƒè¯•ä»£ç 
â”‚   â”œâ”€â”€ tools/               # è°ƒè¯•å·¥å…·ç±»
â”‚   â”‚   â””â”€â”€ debug_kana_review_data_generator.dart  # å‡åå¤ä¹ æ•°æ®ç”Ÿæˆå·¥å…·
â”‚   â””â”€â”€ widgets/             # è°ƒè¯•ä¸“ç”¨ç»„ä»¶
â”‚       â””â”€â”€ debug_test_tile.dart            # è°ƒè¯•æµ‹è¯•é¡¹ç“¦ç‰‡ç»„ä»¶
â”œâ”€â”€ features/                # åŠŸèƒ½æ¨¡å—å±‚ï¼ˆMVVM æ¶æ„ï¼‰
â”‚   â”œâ”€â”€ splash/              # âœ… åº”ç”¨å¯åŠ¨é¡µé¢åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ controller/      # å¯åŠ¨æµç¨‹ç¼–æ’
â”‚   â”‚   â”‚   â””â”€â”€ splash_controller.dart      # å¯åŠ¨é¡µé¢æµç¨‹ç¼–æ’æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ pages/           # å¯åŠ¨é¡µé¢ UI
â”‚   â”‚   â”‚   â””â”€â”€ splash_page.dart            # å¯åŠ¨é¡µé¢ UI å®ç°
â”‚   â”‚   â””â”€â”€ state/           # å¯åŠ¨çŠ¶æ€ç®¡ç†
â”‚   â”‚       â””â”€â”€ splash_state.dart           # å¯åŠ¨é¡µé¢çŠ¶æ€å®šä¹‰
â”‚   â”œâ”€â”€ home/                # âœ… é¦–é¡µ Dashboard åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ controller/      # ä¸»é¡µæµç¨‹ç¼–æ’
â”‚   â”‚   â”‚   â””â”€â”€ home_controller.dart        # ä¸»é¡µæ•°æ®åŠ è½½å’ŒçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ pages/           # ä¸»é¡µ UI å®ç°
â”‚   â”‚   â”‚   â””â”€â”€ home_page.dart              # ä¸»é¡µç•Œé¢å’Œäº¤äº’å®ç°
â”‚   â”‚   â””â”€â”€ state/           # ä¸»é¡µçŠ¶æ€å®šä¹‰
â”‚   â”‚       â””â”€â”€ home_state.dart             # ä¸»é¡µæ•°æ®çŠ¶æ€æ¨¡å‹
â”‚   â”œâ”€â”€ learn/               # âœ… å•è¯å­¦ä¹ æµåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ controller/      # å­¦ä¹ æµç¨‹ç¼–æ’
â”‚   â”‚   â”‚   â”œâ”€â”€ initial_choice_controller.dart  # åˆå§‹é€‰æ‹©é¡µé¢æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â””â”€â”€ learn_controller.dart       # å­¦ä¹ é¡µé¢æ ¸å¿ƒæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ pages/           # å­¦ä¹ é¡µé¢ UI
â”‚   â”‚   â”‚   â”œâ”€â”€ initial_choice_page.dart    # å­¦ä¹ èµ·ç‚¹é€‰æ‹©é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ learn_page.dart             # æ ¸å¿ƒå­¦ä¹ é¡µé¢ï¼ˆæ²‰æµ¸å¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ state/           # å­¦ä¹ çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ initial_choice_state.dart   # åˆå§‹é€‰æ‹©çŠ¶æ€
â”‚   â”‚   â”‚   â””â”€â”€ learn_state.dart            # å­¦ä¹ é¡µé¢çŠ¶æ€
â”‚   â”‚   â””â”€â”€ widgets/         # å­¦ä¹ ä¸“ç”¨ UI ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ audio_play_button.dart      # éŸ³é¢‘æ’­æ”¾æŒ‰é’®ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ example_item.dart           # ä¾‹å¥å±•ç¤ºé¡¹ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ word_choice_card.dart       # å•è¯é€‰æ‹©å¡ç‰‡ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ word_examples_section.dart  # å•è¯ä¾‹å¥åŒºåŸŸç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ word_header.dart            # å•è¯å¤´éƒ¨ä¿¡æ¯ç»„ä»¶
â”‚   â”‚       â””â”€â”€ word_meanings_section.dart  # å•è¯é‡Šä¹‰åŒºåŸŸç»„ä»¶
â”‚   â””â”€â”€ kana/                # ğŸš§ å‡åå­¦ä¹ æ¨¡å—
â”‚       â”œâ”€â”€ chart/           # äº”åéŸ³å›¾åŠŸèƒ½
â”‚       â”‚   â”œâ”€â”€ controller/  # äº”åéŸ³å›¾æ§åˆ¶å™¨
â”‚       â”‚   â”œâ”€â”€ pages/       # äº”åéŸ³å›¾é¡µé¢
â”‚       â”‚   â”œâ”€â”€ state/       # äº”åéŸ³å›¾çŠ¶æ€
â”‚       â”‚   â””â”€â”€ widgets/     # äº”åéŸ³å›¾ä¸“ç”¨ç»„ä»¶
â”‚       â”œâ”€â”€ review/          # å‡åå¤ä¹ åŠŸèƒ½
â”‚       â”‚   â”œâ”€â”€ controller/  # å‡åå¤ä¹ æ§åˆ¶å™¨
â”‚       â”‚   â”œâ”€â”€ pages/       # å‡åå¤ä¹ é¡µé¢
â”‚       â”‚   â””â”€â”€ state/       # å‡åå¤ä¹ çŠ¶æ€
â”‚       â””â”€â”€ stroke/          # ç¬”é¡ºç»ƒä¹ åŠŸèƒ½
â”‚           â”œâ”€â”€ controller/  # ç¬”é¡ºç»ƒä¹ æ§åˆ¶å™¨
â”‚           â”œâ”€â”€ pages/       # ç¬”é¡ºç»ƒä¹ é¡µé¢
â”‚           â””â”€â”€ state/       # ç¬”é¡ºç»ƒä¹ çŠ¶æ€
â”œâ”€â”€ l10n/                    # å›½é™…åŒ–æ”¯æŒ
â”‚   â”œâ”€â”€ app_localizations.dart              # å›½é™…åŒ–ä¸»æ¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ app_localizations_zh.dart           # ä¸­æ–‡æœ¬åœ°åŒ–å®ç°
â”‚   â””â”€â”€ app_zh.arb                          # ä¸­æ–‡èµ„æºå®šä¹‰æ–‡ä»¶
â”œâ”€â”€ router/                  # è·¯ç”±ç®¡ç†
â”‚   â”œâ”€â”€ app_router.dart                     # åº”ç”¨è·¯ç”±é…ç½®ï¼ˆgo_routerï¼‰
â”‚   â””â”€â”€ app_route_observer.dart             # è·¯ç”±ç”Ÿå‘½å‘¨æœŸè§‚å¯Ÿå™¨
â”œâ”€â”€ services/                # æ¨ªåˆ‡å…³æ³¨ç‚¹æœåŠ¡
â”‚   â”œâ”€â”€ audio_service.dart                  # éŸ³é¢‘æ’­æ”¾æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ audio_service_provider.dart         # éŸ³é¢‘æœåŠ¡ Riverpod Provider
â”‚   â”œâ”€â”€ audio_play_controller.dart          # éŸ³é¢‘æ’­æ”¾æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ audio_play_controller_provider.dart # æ’­æ”¾æ§åˆ¶å™¨ Provider
â”‚   â”œâ”€â”€ audio_play_state.dart               # éŸ³é¢‘æ’­æ”¾çŠ¶æ€æ¨¡å‹
â”‚   â””â”€â”€ README.md                           # æœåŠ¡å±‚æ¶æ„è¯´æ˜æ–‡æ¡£
â””â”€â”€ main.dart                # åº”ç”¨ç¨‹åºå…¥å£æ–‡ä»¶
```

**Assets èµ„æºç»“æ„ï¼š**

```
assets/
â”œâ”€â”€ audio/                   # éŸ³é¢‘èµ„æº
â”‚   â”œâ”€â”€ words/               # å•è¯å‘éŸ³éŸ³é¢‘æ–‡ä»¶
â”‚   â”œâ”€â”€ examples/            # ä¾‹å¥æœ—è¯»éŸ³é¢‘æ–‡ä»¶
â”‚   â””â”€â”€ kana/                # å‡åå‘éŸ³éŸ³é¢‘æ–‡ä»¶
â”œâ”€â”€ database/                # æ•°æ®åº“æ–‡ä»¶
â”‚   â””â”€â”€ breeze_jp.sqlite     # é¢„ç½® SQLite æ•°æ®åº“
â””â”€â”€ images/                  # å›¾ç‰‡èµ„æº
    â”œâ”€â”€ icons/               # åº”ç”¨å›¾æ ‡
    â”œâ”€â”€ illustrations/       # æ’å›¾ç´ æ
    â””â”€â”€ backgrounds/         # èƒŒæ™¯å›¾ç‰‡
```

## æ¶æ„å±‚çº§è¯¦ç»†è§„åˆ™

### 1. Core å±‚ï¼ˆå…±äº«åŸºç¡€è®¾æ–½ï¼‰

**èŒè´£è¾¹ç•Œï¼š**

- âœ… æä¾›è·¨æ¨¡å—å¤ç”¨çš„åŸºç¡€èƒ½åŠ›
- âœ… å®šä¹‰å…¨å±€å¸¸é‡å’Œé…ç½®
- âœ… å°è£…ç¬¬ä¸‰æ–¹åº“çš„ä½¿ç”¨
- âŒ ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- âŒ ä¸ä¾èµ– Features å±‚

**å­æ¨¡å—è§„åˆ™ï¼š**

- **algorithm/**: çº¯ç®—æ³•å®ç°ï¼Œæ—  UI ä¾èµ–ï¼Œæ”¯æŒå¤šç§ SRS ç®—æ³•
- **network/**: ç½‘ç»œå±‚æŠ½è±¡ï¼Œç»Ÿä¸€ HTTP å®¢æˆ·ç«¯é…ç½®
- **utils/**: çº¯å‡½æ•°å·¥å…·ï¼Œæ— çŠ¶æ€ï¼Œé«˜åº¦å¯æµ‹è¯•
- **widgets/**: æ— ä¸šåŠ¡é€»è¾‘çš„ UI ç»„ä»¶ï¼Œé«˜åº¦å¯å¤ç”¨

### 2. Data å±‚ï¼ˆæ•°æ®è®¿é—®æŠ½è±¡ï¼‰

**èŒè´£è¾¹ç•Œï¼š**

- âœ… å°è£…æ‰€æœ‰æ•°æ®è®¿é—®é€»è¾‘
- âœ… æä¾›ç»Ÿä¸€çš„æ•°æ®æ¥å£
- âœ… å¤„ç†æ•°æ®è½¬æ¢å’Œç¼“å­˜
- âŒ ä¸åŒ…å« UI ç›¸å…³ä»£ç 
- âŒ ä¸åŒ…å«ä¸šåŠ¡æµç¨‹é€»è¾‘

**å­æ¨¡å—è§„åˆ™ï¼š**

- **models/**: å¿…é¡»å®ç° `fromMap()` å’Œ `toMap()`ï¼Œæ”¯æŒ JSON åºåˆ—åŒ–
- **repositories/**: Entity CRUDï¼ˆå•è¡¨æˆ–å¼ºä¸€è‡´å®ä½“ï¼‰ï¼Œåªè¿”å› Model å¯¹è±¡
- **queries/**: åªè¯»æŸ¥è¯¢ï¼Œæ”¯æŒ join / filter / pagingï¼Œä¸å†™æ•°æ®
- **analytics/**: èšåˆç»Ÿè®¡ä¸æŠ¥è¡¨æŸ¥è¯¢ï¼Œåªè¯»ï¼Œè¿”å› DTO
- **commands/**: ç”¨æˆ·è¡Œä¸ºä¸çŠ¶æ€å˜æ›´çš„å”¯ä¸€å…¥å£ï¼Œå…è®¸äº‹åŠ¡ä¸å¤šè¡¨å†™å…¥

### 3. Features å±‚ï¼ˆåŠŸèƒ½æ¨¡å—ï¼‰

**MVVM æ¶æ„å¼ºåˆ¶è§„åˆ™ï¼š**

- **æ¯ä¸ª Feature å¿…é¡»åŒ…å«**: controller/, pages/, state/ ä¸‰ä¸ªç›®å½•
- **Controller**: ç»§æ‰¿ `Notifier<State>`ï¼Œä¸šåŠ¡æµç¨‹ç¼–æ’ï¼Œè°ƒç”¨ Command / Query / Analytics
- **State**: ä¸å¯å˜ç±»ï¼Œå¿…é¡»æä¾› `copyWith()` æ–¹æ³•
- **Pages**: ç»§æ‰¿ `ConsumerWidget`ï¼Œåªè´Ÿè´£ UI æ¸²æŸ“å’Œç”¨æˆ·äº¤äº’
- **Widgets**: å¯é€‰ï¼ŒFeature ä¸“ç”¨çš„ UI ç»„ä»¶

**æ¨¡å—é—´é€šä¿¡è§„åˆ™ï¼š**

- âœ… é€šè¿‡ Riverpod Provider å…±äº«çŠ¶æ€
- âœ… é€šè¿‡è·¯ç”±å‚æ•°ä¼ é€’æ•°æ®
- âŒ ç¦æ­¢ç›´æ¥å¼•ç”¨å…¶ä»– Feature çš„ Controller
- âŒ ç¦æ­¢è·¨ Feature çš„ State ç›´æ¥è®¿é—®

### 4. Services å±‚ï¼ˆæ¨ªåˆ‡å…³æ³¨ç‚¹ï¼‰

**èŒè´£è¾¹ç•Œï¼š**

- âœ… æä¾›è·¨åŠŸèƒ½çš„æœåŠ¡èƒ½åŠ›
- âœ… å¯¹å¤–éƒ¨ç³»ç»Ÿ / è®¾å¤‡èƒ½åŠ› / ç¬¬ä¸‰æ–¹ SDK çš„æŠ½è±¡
- âœ… å°è£…å¤æ‚çš„ç¬¬ä¸‰æ–¹åº“é›†æˆ
- âœ… ç®¡ç†å…¨å±€çŠ¶æ€å’Œé…ç½®
- âŒ ä¸åŒ…å«ç‰¹å®šä¸šåŠ¡é€»è¾‘
- âŒ ä¸ä½œä¸ºä¸šåŠ¡ Command
- âŒ ä¸åŒ…å«å­¦ä¹  / å¤ä¹  / è¿›åº¦ç­‰ä¸šåŠ¡è§„åˆ™
- âŒ ä¸ç›´æ¥æ“ä½œæ•°æ®åº“

**æœåŠ¡è®¾è®¡è§„åˆ™ï¼š**

- **æ¥å£æŠ½è±¡**: æ¯ä¸ªæœåŠ¡å®šä¹‰æŠ½è±¡æ¥å£
- **Provider æ³¨å…¥**: é€šè¿‡ Riverpod Provider æä¾›å®ä¾‹
- **çŠ¶æ€ç®¡ç†**: æœåŠ¡å†…éƒ¨çŠ¶æ€é€šè¿‡ä¸“ç”¨ State ç±»ç®¡ç†
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†å’Œé”™è¯¯æ¢å¤æœºåˆ¶

### 5. Debug å±‚ï¼ˆå¼€å‘å·¥å…·ï¼‰

**ä½¿ç”¨è§„åˆ™ï¼š**

- âœ… ä»…åœ¨ Debug æ¨¡å¼ä¸‹ç¼–è¯‘
- âœ… æä¾›å¼€å‘å’Œæµ‹è¯•è¾…åŠ©åŠŸèƒ½
- âœ… éµå¾ªä¸ Features ç›¸åŒçš„ MVVM æ¶æ„
- âœ… Debug åªèƒ½é€šè¿‡ Query / Command è®¿é—®ä¸šåŠ¡æ•°æ®
- âŒ ä¸å½±å“ç”Ÿäº§ç¯å¢ƒä»£ç 
- âŒ ä¸åŒ…å«åœ¨ Release æ„å»ºä¸­
- âŒ Debug ä¸å¾—ç›´æ¥è°ƒç”¨ Feature Controller
- âŒ Debug ä¸å¾—ç›´æ¥æ“ä½œ Repository

## æ–‡ä»¶å‘½åä¸ç»„ç»‡è§„èŒƒ

### å‘½åçº¦å®š

| æ–‡ä»¶ç±»å‹      | å‘½åæ ¼å¼                            | ç¤ºä¾‹                            |
| ------------- | ----------------------------------- | ------------------------------- |
| é¡µé¢æ–‡ä»¶      | `[feature]_page.dart`               | `home_page.dart`                |
| æ§åˆ¶å™¨æ–‡ä»¶    | `[feature]_controller.dart`         | `learn_controller.dart`         |
| çŠ¶æ€æ–‡ä»¶      | `[feature]_state.dart`              | `splash_state.dart`             |
| æ¨¡å‹æ–‡ä»¶      | `[entity].dart`                     | `word.dart`, `user.dart`        |
| ä»“åº“æ–‡ä»¶      | `[entity]_repository.dart`          | `word_repository.dart`          |
| Provider æ–‡ä»¶ | `[entity]_repository_provider.dart` | `word_repository_provider.dart` |
| æœåŠ¡æ–‡ä»¶      | `[service]_service.dart`            | `audio_service.dart`            |
| ç»„ä»¶æ–‡ä»¶      | `[component]_widget.dart`           | `word_card_widget.dart`         |

### ç›®å½•ç»„ç»‡åŸåˆ™

**Feature å†…éƒ¨ç»“æ„æ ‡å‡†åŒ–ï¼š**

```
features/[feature_name]/
â”œâ”€â”€ controller/              # å¿…éœ€ï¼šæµç¨‹ç¼–æ’æ§åˆ¶å™¨
â”œâ”€â”€ pages/                   # å¿…éœ€ï¼šUI é¡µé¢å®ç°
â”œâ”€â”€ state/                   # å¿…éœ€ï¼šçŠ¶æ€å®šä¹‰
â””â”€â”€ widgets/                 # å¯é€‰ï¼šFeature ä¸“ç”¨ç»„ä»¶
```

**Repository é…å¥—æ–‡ä»¶ï¼š**

```
repositories/
â”œâ”€â”€ [entity]_repository.dart         # ä»“åº“å®ç°
â””â”€â”€ [entity]_repository_provider.dart # Riverpod Provider
```

**Model åˆ†ç±»ç»„ç»‡ï¼š**

```
models/
â”œâ”€â”€ read/                    # åªè¯»æŸ¥è¯¢ç»“æœæ¨¡å‹
â”œâ”€â”€ [entity].dart           # åŸºç¡€å®ä½“æ¨¡å‹
â””â”€â”€ [entity]_[variant].dart  # å®ä½“å˜ä½“æ¨¡å‹
```

## ä¾èµ–å…³ç³»è§„åˆ™

### å±‚çº§ä¾èµ–æ–¹å‘

```
Features â†’ Services â†’ Data â†’ Core
    â†“         â†“        â†“      â†“
   UI      æ¨ªåˆ‡æœåŠ¡   æ•°æ®è®¿é—®  åŸºç¡€è®¾æ–½
```

### ç¦æ­¢çš„ä¾èµ–å…³ç³»

- âŒ Core å±‚ä¸å¾—ä¾èµ–ä»»ä½•ä¸Šå±‚
- âŒ Data å±‚ä¸å¾—ä¾èµ– Features å±‚
- âŒ Services å±‚ä¸å¾—ä¾èµ– Features å±‚
- âŒ Features é—´ä¸å¾—ç›´æ¥ç›¸äº’ä¾èµ–

### å…è®¸çš„ä¾èµ–å…³ç³»

- âœ… Features å¯ä»¥ä¾èµ– Servicesã€Dataã€Core
- âœ… Services å¯ä»¥ä¾èµ– Dataã€Core
- âœ… Data å¯ä»¥ä¾èµ– Core
- âœ… åŒå±‚å†…éƒ¨æ¨¡å—å¯ä»¥ç›¸äº’ä¾èµ–

## çŠ¶æ€ç®¡ç†æ¶æ„

### Riverpod Provider ç±»å‹ä½¿ç”¨è§„åˆ™

| Provider ç±»å‹      | ä½¿ç”¨åœºæ™¯         | ç¤ºä¾‹                     |
| ------------------ | ---------------- | ------------------------ |
| `NotifierProvider` | Feature çŠ¶æ€ç®¡ç† | `homeControllerProvider` |
| `Provider`         | æ— çŠ¶æ€æœåŠ¡å®ä¾‹   | `wordRepositoryProvider` |
| `FutureProvider`   | å¼‚æ­¥æ•°æ®åŠ è½½     | `activeUserProvider`     |
| `StreamProvider`   | å®æ—¶æ•°æ®æµ       | `audioPlayStateProvider` |

### çŠ¶æ€æ›´æ–°æ¨¡å¼

- **ä¸å¯å˜æ›´æ–°**: æ‰€æœ‰çŠ¶æ€æ›´æ–°å¿…é¡»é€šè¿‡ `copyWith()` æ–¹æ³•
- **å•ä¸€æ•°æ®æº**: æ¯ä¸ªçŠ¶æ€åªæœ‰ä¸€ä¸ªæƒå¨æ¥æº
- **å“åº”å¼æ›´æ–°**: UI é€šè¿‡ `ref.watch()` è‡ªåŠ¨å“åº”çŠ¶æ€å˜åŒ–
- **å‰¯ä½œç”¨éš”ç¦»**: å‰¯ä½œç”¨æ“ä½œåœ¨ Controller ä¸­å¤„ç†ï¼Œä¸åœ¨ Widget ä¸­

## æ•°æ®æµæ¶æ„

### æ ‡å‡†æ•°æ®æµ

```
User Interaction â†’ Controller
                      â”œâ”€â†’ Query / Analytics (Read)
                      â””â”€â†’ Command (Behavior / Write) â†’ Repository â†’ Database
                      â†“
                   State Update
                      â†“
                   UI Rebuild
```

### å¼‚æ­¥æ“ä½œå¤„ç†

- **åŠ è½½çŠ¶æ€**: ä½¿ç”¨ `isLoading` å­—æ®µç®¡ç†åŠ è½½çŠ¶æ€
- **é”™è¯¯å¤„ç†**: ä½¿ç”¨ `error` å­—æ®µå­˜å‚¨é”™è¯¯ä¿¡æ¯
- **é‡è¯•æœºåˆ¶**: Controller æä¾›é‡è¯•æ–¹æ³•
- **ç¼“å­˜ç­–ç•¥**: Repository å±‚å®ç°æ•°æ®ç¼“å­˜é€»è¾‘

## æµ‹è¯•æ¶æ„æ”¯æŒ

### å¯æµ‹è¯•æ€§è®¾è®¡

- **ä¾èµ–æ³¨å…¥**: æ‰€æœ‰ä¾èµ–é€šè¿‡ Provider æ³¨å…¥
- **æ¥å£æŠ½è±¡**: æ ¸å¿ƒæœåŠ¡å®šä¹‰æŠ½è±¡æ¥å£
- **çº¯å‡½æ•°**: Utils å±‚æä¾›çº¯å‡½æ•°å·¥å…·
- **çŠ¶æ€éš”ç¦»**: æ¯ä¸ª Feature çŠ¶æ€ç‹¬ç«‹å¯æµ‹

### æµ‹è¯•æ–‡ä»¶ç»„ç»‡

```
test/
â”œâ”€â”€ unit/                    # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ core/               # Core å±‚æµ‹è¯•
â”‚   â”œâ”€â”€ data/               # Data å±‚æµ‹è¯•
â”‚   â””â”€â”€ services/           # Services å±‚æµ‹è¯•
â”œâ”€â”€ widget/                  # Widget æµ‹è¯•
â”‚   â””â”€â”€ features/           # Features UI æµ‹è¯•
â””â”€â”€ integration/             # é›†æˆæµ‹è¯•
    â””â”€â”€ flows/              # ç”¨æˆ·æµç¨‹æµ‹è¯•
```

## æ€§èƒ½ä¼˜åŒ–æ¶æ„

### å†…å­˜ç®¡ç†

- **Provider ç”Ÿå‘½å‘¨æœŸ**: åˆç†ä½¿ç”¨ `autoDispose` ä¿®é¥°ç¬¦
- **çŠ¶æ€ç¼“å­˜**: é¿å…ä¸å¿…è¦çš„çŠ¶æ€é‡å»º
- **èµ„æºé‡Šæ”¾**: åŠæ—¶é‡Šæ”¾éŸ³é¢‘ã€å›¾ç‰‡ç­‰èµ„æº

### æ¸²æŸ“ä¼˜åŒ–

- **Widget æ‹†åˆ†**: ä¿æŒ Widget ç²’åº¦é€‚ä¸­
- **çŠ¶æ€å±€éƒ¨åŒ–**: é¿å…å…¨å±€çŠ¶æ€çš„è¿‡åº¦ä½¿ç”¨
- **æ‡’åŠ è½½**: å¤§åˆ—è¡¨ä½¿ç”¨æ‡’åŠ è½½ç­–ç•¥

### æ•°æ®åº“ä¼˜åŒ–

- **æŸ¥è¯¢ä¼˜åŒ–**: ä½¿ç”¨ç´¢å¼•å’Œåˆç†çš„æŸ¥è¯¢æ¡ä»¶
- **æ‰¹é‡æ“ä½œ**: é¿å…é¢‘ç¹çš„å•æ¡æ•°æ®æ“ä½œ
- **è¿æ¥æ± ç®¡ç†**: åˆç†ç®¡ç†æ•°æ®åº“è¿æ¥
