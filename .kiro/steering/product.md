---
inclusion: always
---

# BreezeJP MVP 产品需求文档

## 产品概述

BreezeJP 是一款追求极致「心流」体验的日语单词记忆 App。采用全屏沉浸式交互（类似 TikTok）和关联语义探索（类似维基百科漫游），解决背单词枯燥和“孤岛记忆”的问题。

### 核心价值

- **沉浸感**：去 UI 化，全屏展示
- **清晰交互**：左右滑动切换单词，上下滑动查看详情，彻底解决手势冲突
- **关联性**：学完「狗」推荐「猫」，建立语义网络
- **掌控感**：通过分支选择避免难度失控，用户决定学习路径
- **自由度**：无每日新词上限，用户可无限探索
- **科学性**：底层支持 SM-2 与 FSRS 双算法引擎

---

## 应用架构

舍弃底部导航栏，采用单页 Dashboard 结构，所有功能入口汇聚于首页。

---

## 功能模块

# 首页（Dashboard）

首页是 BreezeJP 的学习控制中心。所有核心学习入口（单词学习、五十音学习、复习模式）均集中于首页，并以极简、轻负担的方式呈现。首页采用卡片式布局，可垂直滚动，由以下模块组成：

1. Header（顶部区域）
2. Primary Actions（学习主入口）
3. Review Section（复习模块）
4. Stats Card（学习统计）
5. Tools Grid（工具区）

首页需要同时兼顾两类用户情境：

- 新用户：没有任何单词与五十音学习记录
- 已学习用户：拥有单词与/或五十音学习进度

模块展示需要根据用户状态智能调整。

---

## 1. Header（顶部区域）

展示内容：

- 问候语（根据时间段自动切换）
- 用户昵称（来自 users 表）
- 设置按钮

新用户：

- 可显示“欢迎开始你的日语之旅”类文案
- 没有学习记录也不会出现空白区域

已有学习记录用户：

- 正常显示问候语与昵称

Header 不依赖任何学习数据，无需区分处理，整体风格保持轻量与友好。

---

## 2. Primary Actions（学习主入口）

此区域用于承载学习行为的主入口，始终出现在首页的顶部区域下方。包含两个入口：

- 学习新单词（Learn New Words）
- 学习五十音图（Learn Kana）

### 学习新单词（Learn New Words）

功能：

- 进入 BreezeJP 的语义分支学习模式，以关联词语构建学习链条
- 不显示固定学习进度，保持心流式学习（无任务、无章节、无进度条）
- 此入口始终可用，不会因复习任务未完成而禁用

### 学习五十音图（Learn Kana）

功能：

- 进入五十音学习页，包括笔顺、读音、描红等内容
- 不需要显示“已学 XX 个假名”等进度，保持模块简洁
- 用户自由选择从任意假名继续学习（五十音为固定集合，无需进度提示）
- 该入口始终可用，与单词学习入口同级

---

## 3. Review Section（复习模块）

复习是 BreezeJP SRS 学习体系的核心功能。
本模块包含两个并列入口：

- 复习单词（Review Words）
- 复习五十音图（Review Kana）

### 复习单词（Review Words）

数据逻辑：
统计 `study_words` 表中满足以下条件的数量：

- `user_id = 当前用户`
- `learning_status = learning`
- `next_review_at <= now`

新用户：

- 无复习数据，显示：“还没有需要复习的单词”
- 显示“0 个待复习”，入口仍可点击（引导至学习新单词）

已有学习记录用户：

- 若有待复习：显示“今日待复习：X 个单词”
- 若已清空复习：显示“今日已复习完成”或“0 个待复习”

### 复习五十音图（Review Kana）

数据逻辑：
统计 `kana_learning_state` 表中满足：

- `user_id = 当前用户`
- `learning_status = learning`
- `next_review_at <= now`

新用户：

- 无需复习，显示：“还没有需要复习的假名”
- 显示“0 个待复习”，点击后引导用户去学习五十音

已有学习记录用户：

- 若有待复习：显示“今日待复习：X 个假名”
- 若无待复习：显示“今日假名复习已完成”

### 复习模块设计原则

- 复习入口永不隐藏（即使数量为 0）
- 复习不压制学习：用户可自由选择先学新内容再复习
- 单词与五十音拥有独立 SRS 队列，各自独立展示

---

## 4. Stats Card（学习统计）

以卡片形式展示用户的关键学习指标：

- 今日已学习单词数
- 今日已复习单词数
- 累计掌握单词数
- 连续学习天数
- 今日学习时长

数据来源：
`daily_stats` 表（按天聚合的学习统计数据）

新用户：

- 所有数值为 0
- 文案显示为引导样式，例如：
  - “今天还没有开始学习，试着学一个新单词吧”
  - “连续学习天数将在你开始学习后记录”

已有学习记录用户：

- 正常显示具体数值
- 若某项为 0，不需要特殊处理

---

## 5. Tools Grid（工具区）

用于展示低频但重要的工具性页面入口，例如：

- 单词本
- 详细统计

此区域对新用户与老用户完全一致。

---

## Word 学习生命周期（Learning Lifecycle）【冻结】

### 一、学习状态定义

Word 与 Kana 使用统一的 `LearningStatus` 枚举：

| 状态 | 含义 |
|----|----|
| `seen` | 用户已看到该单词，但尚未加入复习 |
| `learning` | 用户主动选择学习，已进入 SRS 队列 |
| `mastered` | 用户已掌握，不再进入复习 |
| `ignored` | 用户明确忽略，可手动恢复 |

---

### 二、seen 状态的唯一创建时机（冻结）

Word 的 `seen` 状态**只允许在以下时机创建**：

- 当用户在 Learn 页面中 **通过左右滑动第一次看到该单词时**
- 触发位置：`LearnController.onPageChanged`
- 行为：`getOrCreateLearningState`
- 不触发 UI 变化、不进入 SRS、不写统计

明确禁止在以下场景创建 `seen`：

- 页面初始化
- 数据加载
- 音频播放
- 停留时间判断
- 用户点击按钮

---

### 三、learning 状态的唯一进入方式（冻结）

Word 的 `learning` 状态只能由用户显式行为触发：

- 点击「加入复习」
- 点击「一键掌握」（内部拆为 `seen → learning → mastered`）

禁止任何自动或隐式进入 `learning` 的行为。

---

### 四、mastered 状态规则（冻结）

- UI 层允许一键完成“掌握”
- 数据层必须严格拆分为：

seen → learning → mastered


该规则用于保证：

- SRS 参数完整初始化
- 日志与统计语义一致
- 后续算法扩展不返工

---

### 五、ignored 状态规则（冻结）

- 任意状态可进入 `ignored`
- `ignored` 状态：
  - 不进入 SRS 队列
  - 不计入学习 / 掌握统计
- 用户可通过再次点击「忽略」按钮：
  - 将 `ignored` 恢复为 `seen`

---

### 六、Word 操作栏（UI 冻结规则）

学习页底部固定展示操作栏，根据状态切换按钮集合：

| 状态 | 可见按钮 |
|----|----|
| `seen` | 加入复习 / 一键掌握 / 忽略 |
| `learning` | 已掌握 / 忽略 |
| `mastered` | 忽略 |
| `ignored` | 忽略（用于恢复为 seen） |

UI 仅负责展示与回调分发，不包含任何状态流转逻辑。

---

### 七、与 Kana 的对齐声明（冻结）

- Word 与 Kana 使用同一套 `LearningStatus` 语义
- Word 的 `seen` ≈ Kana 的“展示即 seen”
- Word 的 `learning` ≈ Kana 的“描红完成后进入学习”
- Command / Query / Controller 层级结构保持同构

---

### 八、设计目标总结

该生命周期设计确保：

- 用户行为完全可控
- 状态语义稳定、可预测
- UI 与业务严格解耦
- 与 SRS 与统计系统天然兼容

**Word 学习生命周期自 MVP 起冻结。**

---

## 记忆算法

- 默认使用 SM-2
- 支持 FSRS
- 使用 `stability` 与 `difficulty` 字段

---

## UI / UX 规范

- 学习模式左右滑动切换单词
- 页面切换时触发轻量震动反馈
- 右上角显示 Session 学习计数
- 所有用户可见文本必须使用 `AppLocalizations`，禁止硬编码

---

# BreezeJP 五十音复习题型选择系统（全局架构）

## 系统目标

- 多维巩固：听觉 / 视觉 / 回忆并用
- 降低枯燥：避免单一题型
- SRS 兼容：评分仍使用 Again / Good / Easy
- 轻量 MVP：不新增表结构，逻辑尽量简单

---

## 题型选择引擎（Selector）

### Step 1：读取熟练度（kana_learning_state）

- 弱项（Weak）：`fail_count ≥ 3`
- 初级（New）：`streak ≤ 1`
- 熟练（Strong）：`streak ≥ 2`

---

### Step 2：按熟练度给题型优先级

| 熟练度 | 优先 1 | 优先 2 | 优先 3 |
|------|------|------|------|
| 弱项 | 听音辨假名 | 平片对照 | 读音回忆 |
| 初级 | 平片对照 | 听音辨假名 | — |
| 熟练 | 读音回忆 | 平片对照 | 听音辨假名 |

---

### Step 3：避免短期重复

读取 `kana_logs` 最近一次题型，如与当前优先题型相同，则切换至下一优先级。

---

### Step 4：确定题型

按优先级 → 去重 → 得到最终题型。

---

## 与 SRS 的关系

- 题型决定“怎么提问”
- SRS 评分决定“何时再复习”
- 所有题型统一进入 SRS 排期流程

---

## 当前实现阶段（MVP）

支持题型：

- 读音回忆
- 听音辨假名
- 平假名 ↔ 片假名对照

设计原则：

- 模式可独立进入，互不阻塞
- 所有题型进入统一 SRS
- Dashboard 中清晰展示复习入口